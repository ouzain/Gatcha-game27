import{a as A}from"./chunk-XX22AALN.js";import{b as _,c as T,d as L,e as N,f as V,g as k,h as z,i as G,j as $,k as q,l as D}from"./chunk-YXDBG4CB.js";import{a as j}from"./chunk-5NYNIZ4Q.js";import"./chunk-AUALO7ST.js";import{$ as v,A as o,B as g,E as C,I as d,K as a,N as i,O as n,Q as h,R as S,S as c,T as r,V as p,X as u,Z as M,_ as f,aa as y,ea as B,fa as I,ga as E,ia as w,ja as O,ka as F,ua as P,v as b,w as x}from"./chunk-SP6T3Q2V.js";var R=t=>["/battles",t];function H(t,l){t&1&&(i(0,"div",2)(1,"p"),r(2,"Chargement de vos monstres..."),n()())}function J(t,l){t&1&&(i(0,"div",2)(1,"p"),r(2,"Vous avez besoin d'au moins 2 monstres pour commencer un combat."),n(),i(3,"a",8),r(4,"Invoquez plus de monstres"),n()())}function K(t,l){if(t&1&&(i(0,"option",19),r(1),f(2,"titlecase"),n()),t&2){let e=l.$implicit;a("value",e.id),o(),u(" ",e.name," (Niv. ",e.level,", ",v(2,4,e.elementType),") ")}}function Q(t,l){if(t&1&&(i(0,"option",19),r(1),f(2,"titlecase"),n()),t&2){let e=l.$implicit;a("value",e.id),o(),u(" ",e.name," (Niv. ",e.level,", ",v(2,4,e.elementType),") ")}}function U(t,l){t&1&&(i(0,"div",20),r(1," Vous ne pouvez pas s\xE9lectionner deux fois le m\xEAme monstre "),n())}function W(t,l){if(t&1){let e=h();i(0,"form",9),S("ngSubmit",function(){b(e);let s=c();return x(s.startBattle())}),i(1,"div",10)(2,"label",11),r(3,"Premier Monstre"),n(),i(4,"select",12)(5,"option",13),r(6,"S\xE9lectionner un monstre"),n(),d(7,K,3,6,"option",14),n()(),i(8,"div",10)(9,"label",15),r(10,"Deuxi\xE8me Monstre"),n(),i(11,"select",16)(12,"option",13),r(13,"S\xE9lectionner un monstre"),n(),d(14,Q,3,6,"option",14),n(),d(15,U,2,0,"div",17),n(),i(16,"button",18),r(17),n()()}if(t&2){let e=c();a("formGroup",e.battleForm),o(7),a("ngForOf",e.monsters),o(7),a("ngForOf",e.monsters),o(),a("ngIf",e.battleForm.errors==null?null:e.battleForm.errors.sameMonster),o(),a("disabled",e.battleForm.invalid||e.isStartingBattle),o(),p(" ",e.isStartingBattle?"Lancement du combat...":"Commencer la bataille"," ")}}function X(t,l){t&1&&(i(0,"div",2)(1,"p"),r(2,"Chargement de l'historique des combats..."),n()())}function Y(t,l){t&1&&(i(0,"div",2)(1,"p"),r(2,"Aucun combat trouv\xE9. Commencez votre premier combat !"),n()())}function Z(t,l){if(t&1&&(i(0,"div",34),r(1),n()),t&2){let e=c().$implicit;a("ngClass",e.monster1.elementType),o(),p(" ",e.monster1.name," ")}}function ee(t,l){if(t&1&&(i(0,"div",34),r(1),n()),t&2){let e=c().$implicit;a("ngClass",e.monster2.elementType),o(),p(" ",e.monster2.name," ")}}function te(t,l){if(t&1&&(i(0,"span",35),r(1),n()),t&2){let e=c().$implicit;a("ngClass",e.winner.elementType),o(),p(" ",e.winner.name," ")}}function ne(t,l){if(t&1&&(i(0,"div",23)(1,"div",24)(2,"div",25),d(3,Z,2,2,"div",26),i(4,"span",27),r(5,"VS"),n(),d(6,ee,2,2,"div",26),n(),i(7,"div",28)(8,"span",29),r(9,"Gagnant :"),n(),d(10,te,2,2,"span",30),n(),i(11,"div",31),r(12),f(13,"date"),n()(),i(14,"div",32)(15,"a",33),r(16,"Voir le replay"),n()()()),t&2){let e=l.$implicit;o(3),a("ngIf",e.monster1),o(3),a("ngIf",e.monster2),o(4),a("ngIf",e.winner),o(2),p(" ",y(13,5,e.date,"medium")," "),o(3),a("routerLink",M(8,R,e.id))}}function ie(t,l){if(t&1&&(i(0,"div",21),d(1,ne,17,10,"div",22),n()),t&2){let e=c();o(),a("ngForOf",e.battles)}}function oe(t,l){if(t&1&&(i(0,"div",36),r(1),n()),t&2){let e=c();o(),p(" ",e.errorMessage," ")}}var ge=(()=>{class t{constructor(e,m,s){this.fb=e,this.battleService=m,this.monsterService=s,this.monsters=[],this.battles=[],this.isLoadingMonsters=!0,this.isLoadingBattles=!0,this.isStartingBattle=!1,this.errorMessage="",this.battleForm=this.fb.group({monster1Id:["",_.required],monster2Id:["",_.required]},{validators:this.differentMonstersValidator})}ngOnInit(){this.loadMonsters(),this.loadBattles()}differentMonstersValidator(e){let m=e.get("monster1Id")?.value,s=e.get("monster2Id")?.value;return m&&s&&m===s?{sameMonster:!0}:null}loadMonsters(){this.isLoadingMonsters=!0,this.monsterService.getMonsters().subscribe({next:e=>{this.monsters=e,this.isLoadingMonsters=!1},error:e=>{this.errorMessage="Failed to load monsters. Please try again.",this.isLoadingMonsters=!1,console.error("Error loading monsters:",e)}})}loadBattles(){this.isLoadingBattles=!0,this.battleService.getBattles().subscribe({next:e=>{this.battles=e,this.isLoadingBattles=!1},error:e=>{this.errorMessage="Failed to load battle history. Please try again.",this.isLoadingBattles=!1,console.error("Error loading battles:",e)}})}startBattle(){if(this.battleForm.invalid)return;this.isStartingBattle=!0;let{monster1Id:e,monster2Id:m}=this.battleForm.value;this.battleService.startBattle(e,m).subscribe({next:s=>{this.isStartingBattle=!1,this.loadBattles(),this.battleForm.reset()},error:s=>{this.errorMessage="\xC9chec du lancement du combat. Veuillez r\xE9essayer",this.isStartingBattle=!1,console.error("Erreur lors du lancement de la bataille : ",s)}})}static{this.\u0275fac=function(m){return new(m||t)(g(q),g(A),g(j))}}static{this.\u0275cmp=C({type:t,selectors:[["app-battles"]],decls:14,vars:7,consts:[[1,"battles-container"],[1,"card","battle-form-card"],[1,"text-center"],["class","text-center",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"card","battle-history-card"],["class","battle-list",4,"ngIf"],["class","error-message text-center mt-3",4,"ngIf"],["routerLink","/summon",1,"btn","mt-3"],[3,"ngSubmit","formGroup"],[1,"form-group"],["for","monster1"],["id","monster1","formControlName","monster1Id",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","monster2"],["id","monster2","formControlName","monster2Id",1,"form-control"],["class","error-message",4,"ngIf"],["type","submit",1,"btn","w-100",3,"disabled"],[3,"value"],[1,"error-message"],[1,"battle-list"],["class","battle-item",4,"ngFor","ngForOf"],[1,"battle-item"],[1,"battle-info"],[1,"battle-monsters"],["class","battle-monster",3,"ngClass",4,"ngIf"],[1,"vs"],[1,"battle-result"],[1,"winner-label"],["class","winner-name",3,"ngClass",4,"ngIf"],[1,"battle-date"],[1,"battle-actions"],[1,"btn","btn-small",3,"routerLink"],[1,"battle-monster",3,"ngClass"],[1,"winner-name",3,"ngClass"],[1,"error-message","text-center","mt-3"]],template:function(m,s){m&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),r(3,"Commencer un combat"),n(),d(4,H,3,0,"div",3)(5,J,5,0,"div",3)(6,W,18,6,"form",4),n(),i(7,"div",5)(8,"h2",2),r(9,"Historique des combats"),n(),d(10,X,3,0,"div",3)(11,Y,3,0,"div",3)(12,ie,2,1,"div",6),n(),d(13,oe,2,1,"div",7),n()),m&2&&(o(4),a("ngIf",s.isLoadingMonsters),o(),a("ngIf",!s.isLoadingMonsters&&s.monsters.length<2),o(),a("ngIf",!s.isLoadingMonsters&&s.monsters.length>=2),o(4),a("ngIf",s.isLoadingBattles),o(),a("ngIf",!s.isLoadingBattles&&s.battles.length===0),o(),a("ngIf",!s.isLoadingBattles&&s.battles.length>0),o(),a("ngIf",s.errorMessage))},dependencies:[F,B,I,E,w,O,P,D,N,G,$,z,T,L,V,k],styles:[".battles-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px;padding:20px 0}@media (min-width: 768px){.battles-container[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.w-100[_ngcontent-%COMP%]{width:100%}.battle-list[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto}.battle-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px;margin-bottom:15px;background-color:#ffffff0d;border-radius:4px}.battle-monsters[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px}.battle-monster[_ngcontent-%COMP%]{padding:5px 10px;border-radius:4px;font-weight:500}.battle-monster.fire[_ngcontent-%COMP%]{background-color:#ff572233;color:var(--fire-color)}.battle-monster.water[_ngcontent-%COMP%]{background-color:#2196f333;color:var(--water-color)}.battle-monster.wind[_ngcontent-%COMP%]{background-color:#4caf5033;color:var(--wind-color)}.vs[_ngcontent-%COMP%]{font-weight:600;color:var(--secondary-color)}.battle-result[_ngcontent-%COMP%]{margin-bottom:5px}.winner-label[_ngcontent-%COMP%]{margin-right:5px;font-size:.9rem}.winner-name[_ngcontent-%COMP%]{font-weight:600}.winner-name.fire[_ngcontent-%COMP%]{color:var(--fire-color)}.winner-name.water[_ngcontent-%COMP%]{color:var(--water-color)}.winner-name.wind[_ngcontent-%COMP%]{color:var(--wind-color)}.battle-date[_ngcontent-%COMP%]{font-size:.8rem;color:#aaa}.btn-small[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem}"]})}}return t})();export{ge as BattlesComponent};
