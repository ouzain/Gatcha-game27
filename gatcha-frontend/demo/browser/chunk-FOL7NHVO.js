import{a as f}from"./chunk-OS54V6FA.js";import{a as U}from"./chunk-5NYNIZ4Q.js";import{a as $}from"./chunk-PQSCT4QP.js";import{a as v}from"./chunk-AUALO7ST.js";import{$ as C,A as r,B as p,E as O,I as u,K as m,N as i,O as n,Q as w,R as L,S as c,T as o,U as d,V as _,W as y,Z as S,_ as M,ea as H,fa as T,ga as k,ia as j,ka as F,l as b,la as z,ma as A,na as V,p as P,ra as q,s as g,ua as N,v as E,w as I}from"./chunk-SP6T3Q2V.js";var B=(()=>{class t{constructor(e,s,a){this.http=e,this.monsterService=s,this.authService=a,this.summondedMonsterId=0}summonMonster(){let e=this.authService.getToken();if(!e)throw new Error("Token non disponible");let s=new z().set("Authorization",`Bearer ${e}`),a=new A().set("Authorization",e);return this.http.post(`${v.playerApiUrl}/acquire-monster`,null,{params:a}).pipe(b(x=>{let h=x.data;return this.summondedMonsterId=h,console.log("Monstre invoqu\xE9 avec l'id :",h),this.monsterService.getMonster(h)}))}getSummonHistory(){return this.http.get(`${v.invocationApiUrl}/summon/history`)}regenerateSummons(){return this.http.post(`${v.invocationApiUrl}/summon/regenerate`,{})}static{this.\u0275fac=function(s){return new(s||t)(g(V),g(U),g(f))}}static{this.\u0275prov=P({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var D=t=>["/monsters",t];function G(t,l){t&1&&(i(0,"div",2)(1,"p"),o(2,"Chargement du profil..."),n()())}function J(t,l){t&1&&(i(0,"div",13)(1,"p"),o(2,"Votre stockage de monstres est plein ! Lib\xE9rez des monstres ou am\xE9liorez votre niveau pour augmenter votre capacit\xE9."),n()())}function Q(t,l){if(t&1){let e=w();i(0,"div")(1,"div",9)(2,"p"),o(3),n(),u(4,J,3,0,"div",10),n(),i(5,"div",11)(6,"button",12),L("click",function(){E(e);let a=c();return I(a.summonMonster())}),o(7),n()()()}if(t&2){let e=c();r(3),y("Vous avez ",e.user.monsterList.length," / ",e.user.maxMonsters," monstres."),r(),m("ngIf",e.user.monsterList.length>=e.user.maxMonsters),r(2),m("disabled",e.isSummoning||e.user.monsterList.length>=e.user.maxMonsters),r(),_(" ",e.isSummoning?"Invocation en cours...":"Invoquer un monstre"," ")}}function W(t,l){if(t&1&&(i(0,"div",14)(1,"h3",2),o(2,"Vous avez invoqu\xE9 :"),n(),i(3,"div",15)(4,"div",16)(5,"h3"),o(6),n(),i(7,"span",17),o(8),M(9,"titlecase"),n()(),i(10,"div",18)(11,"div",19)(12,"span",20),o(13,"Niveau :"),n(),i(14,"span",21),o(15),n()(),i(16,"div",19)(17,"span",20),o(18,"PV :"),n(),i(19,"span",21),o(20),n()(),i(21,"div",19)(22,"span",20),o(23,"ATK :"),n(),i(24,"span",21),o(25),n()(),i(26,"div",19)(27,"span",20),o(28,"DEF :"),n(),i(29,"span",21),o(30),n()(),i(31,"div",19)(32,"span",20),o(33,"VIT :"),n(),i(34,"span",21),o(35),n()(),i(36,"div",19)(37,"span",20),o(38,"Exp\xE9rience :"),n(),i(39,"span",21),o(40),n()()(),i(41,"div",22)(42,"a",23),o(43,"Voir les d\xE9tails"),n()()()()),t&2){let e=c();r(4),m("ngClass",e.summonedMonster.elementType),r(2),d("Monstre"+e.summonedMonster.id),r(2),d(C(9,11,e.summonedMonster.elementType)),r(7),d(e.summonedMonster.level),r(5),d(e.summonedMonster.hp),r(5),d(e.summonedMonster.atk),r(5),d(e.summonedMonster.def),r(5),d(e.summonedMonster.vit),r(5),y("",e.summonedMonster.experience," / ",e.summonedMonster.maxExperience," XP"),r(2),m("routerLink",S(13,D,e.summonedMonster.id))}}function Y(t,l){if(t&1&&(i(0,"div",24),o(1),n()),t&2){let e=c();r(),_(" ",e.errorMessage," ")}}function Z(t,l){t&1&&(i(0,"div",2)(1,"p"),o(2,"Chargement de l'historique des invocations..."),n()())}function ee(t,l){t&1&&(i(0,"div",2)(1,"p"),o(2,"Aucune invocation r\xE9cente."),n()())}function te(t,l){if(t&1&&(i(0,"div",27)(1,"div",28)(2,"span",29),o(3),n(),i(4,"span",30),o(5),M(6,"titlecase"),n()(),i(7,"a",31),o(8,"Voir"),n()()),t&2){let e=l.$implicit;r(),m("ngClass",e.elementType),r(2),d(e.name),r(2),d(C(6,4,e.elementType)),r(2),m("routerLink",S(6,D,e.id))}}function ne(t,l){if(t&1&&(i(0,"div",25),u(1,te,9,8,"div",26),n()),t&2){let e=c();r(),m("ngForOf",e.summonHistory)}}var ue=(()=>{class t{constructor(e,s,a,x){this.summonService=e,this.playerService=s,this.route=a,this.authService=x,this.user=null,this.summonedMonster=null,this.summonHistory=[],this.isLoadingProfile=!0,this.isLoadingHistory=!0,this.isSummoning=!1,this.errorMessage=""}ngOnInit(){this.route.queryParams.subscribe(e=>{let s=this.authService.getUsername();s?this.loadProfile(s):this.errorMessage="No username provided."}),this.loadSummonHistory()}loadProfile(e){this.isLoadingProfile=!0,this.playerService.getProfile(e).subscribe({next:s=>{this.user=s,this.isLoadingProfile=!1},error:s=>{this.errorMessage="Failed to load profile. Please try again.",this.isLoadingProfile=!1,console.error("Error loading profile:",s)}})}loadSummonHistory(){this.isLoadingHistory=!0,this.summonService.getSummonHistory().subscribe({next:e=>{this.summonHistory=e,this.isLoadingHistory=!1},error:e=>{console.error("Error loading summon history:",e),this.isLoadingHistory=!1}})}summonMonster(){!this.user||this.user.monsterList.length>=this.user.maxMonsters||(this.isSummoning=!0,this.summonedMonster=null,this.summonService.summonMonster().subscribe({next:e=>{this.summonedMonster=e,this.isSummoning=!1,this.loadProfile(this.user.username),this.loadSummonHistory()},error:e=>{this.errorMessage="Failed to summon monster. Please try again.",this.isSummoning=!1,console.error("Error summoning monster:",e)}}))}static{this.\u0275fac=function(s){return new(s||t)(p(B),p($),p(q),p(f))}}static{this.\u0275cmp=O({type:t,selectors:[["app-summon"]],decls:14,vars:7,consts:[[1,"invocation-container"],[1,"card","invocation-card"],[1,"text-center"],["class","text-center",4,"ngIf"],[4,"ngIf"],["class","summoned-monster",4,"ngIf"],["class","error-message text-center mt-3",4,"ngIf"],[1,"card","summon-history-card"],["class","summon-history",4,"ngIf"],[1,"invocation-info"],["class","error-message text-center",4,"ngIf"],[1,"invocation-action"],[1,"btn","invocation-btn",3,"click","disabled"],[1,"error-message","text-center"],[1,"summoned-monster"],[1,"card","monster-card"],[1,"monster-header",3,"ngClass"],[1,"element-badge"],[1,"monster-stats"],[1,"stat"],[1,"stat-label"],[1,"stat-value"],[1,"monster-actions"],[1,"btn",3,"routerLink"],[1,"error-message","text-center","mt-3"],[1,"summon-history"],["class","history-item",4,"ngFor","ngForOf"],[1,"history-item"],[1,"history-monster",3,"ngClass"],[1,"monster-name"],[1,"element-badge","small"],[1,"btn","btn-small",3,"routerLink"]],template:function(s,a){s&1&&(i(0,"div",0)(1,"div",1)(2,"h2",2),o(3,"Invocation de monstre"),n(),u(4,G,3,0,"div",3)(5,Q,8,5,"div",4)(6,W,44,15,"div",5)(7,Y,2,1,"div",6),n(),i(8,"div",7)(9,"h3",2),o(10,"Invocations r\xE9centes"),n(),u(11,Z,3,0,"div",3)(12,ee,3,0,"div",3)(13,ne,2,1,"div",8),n()()),s&2&&(r(4),m("ngIf",a.isLoadingProfile),r(),m("ngIf",!a.isLoadingProfile&&a.user),r(),m("ngIf",a.summonedMonster),r(),m("ngIf",a.errorMessage),r(4),m("ngIf",a.isLoadingHistory),r(),m("ngIf",!a.isLoadingHistory&&a.summonHistory.length===0),r(),m("ngIf",!a.isLoadingHistory&&a.summonHistory.length>0))},dependencies:[F,H,T,k,j,N],styles:[".invocation-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:20px;padding:20px 0}@media (min-width: 768px){.invocation-container[_ngcontent-%COMP%]{grid-template-columns:2fr 1fr}}.invocation-info[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.invocation-action[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:30px}.invocation-btn[_ngcontent-%COMP%]{padding:15px 30px;font-size:1.2rem}.summoned-monster[_ngcontent-%COMP%]{margin-top:30px}.summoned-monster[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:15px}.monster-card[_ngcontent-%COMP%]{max-width:400px;margin:0 auto}.monster-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:10px;margin-bottom:15px;border-bottom:2px solid #333}.monster-header.fire[_ngcontent-%COMP%]{border-color:var(--fire-color)}.monster-header.water[_ngcontent-%COMP%]{border-color:var(--water-color)}.monster-header.wind[_ngcontent-%COMP%]{border-color:var(--wind-color)}.element-badge[_ngcontent-%COMP%]{padding:3px 8px;border-radius:4px;font-size:.8rem;font-weight:600}.element-badge.small[_ngcontent-%COMP%]{padding:2px 6px;font-size:.7rem}.fire[_ngcontent-%COMP%]   .element-badge[_ngcontent-%COMP%]{background-color:#ff572233;color:var(--fire-color)}.water[_ngcontent-%COMP%]   .element-badge[_ngcontent-%COMP%]{background-color:#2196f333;color:var(--water-color)}.wind[_ngcontent-%COMP%]   .element-badge[_ngcontent-%COMP%]{background-color:#4caf5033;color:var(--wind-color)}.monster-stats[_ngcontent-%COMP%]{margin-bottom:15px}.stat[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.stat-label[_ngcontent-%COMP%]{font-weight:500}.monster-actions[_ngcontent-%COMP%]{text-align:center}.summon-history[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}.history-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;margin-bottom:10px;background-color:#ffffff0d;border-radius:4px}.history-monster[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.monster-name[_ngcontent-%COMP%]{font-weight:500}.btn-small[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem}"]})}}return t})();export{ue as SummonComponent};
