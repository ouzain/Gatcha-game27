import{a}from"./chunk-AUALO7ST.js";import{d as l,f as u,g as n,h,j as s,m as c,na as m,p,s as g}from"./chunk-SP6T3Q2V.js";var T=(()=>{class r{constructor(t){this.http=t,this.TOKEN_KEY="auth_token",this.USERNAME_KEY="username",this.isAuthenticatedSubject=new l(this.hasToken()),this.isAuthenticated$=this.isAuthenticatedSubject.asObservable(),this.checkTokenValidity()}login(t,o){return this.clearLocalStorage(),this.http.post(`${a.playerApiUrl}/authenticate`,{username:t,password:o}).pipe(c(e=>{let i=e.data;if(i)this.setToken(i),this.setUsername(t),this.isAuthenticatedSubject.next(!0);else throw new Error("Token non trouv\xE9 dans la r\xE9ponse")}),h(()=>!0),s(e=>(console.error("Login error:",e),n(()=>new Error(e.error?.message||"Login failed")))))}register(t,o){return this.clearLocalStorage(),this.http.post(`${a.playerApiUrl}/add`,{username:t,password:o}).pipe(c(e=>{let i=e.data;this.setToken(i),this.setUsername(t),this.isAuthenticatedSubject.next(!0)}),h(()=>!0),s(e=>(console.error("Registration error:",e),n(()=>new Error(e.error?.message||"Registration failed")))))}logout(){this.clearLocalStorage(),this.isAuthenticatedSubject.next(!1)}getToken(){return localStorage.getItem(this.TOKEN_KEY)}getUsername(){return localStorage.getItem(this.USERNAME_KEY)}setToken(t){localStorage.setItem(this.TOKEN_KEY,t)}setUsername(t){localStorage.setItem(this.USERNAME_KEY,t)}hasToken(){return!!this.getToken()}clearLocalStorage(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USERNAME_KEY)}checkTokenValidity(){this.hasToken()&&this.http.get(`${a.authApiUrl}/validate`).pipe(s(()=>(this.logout(),u({valid:!1})))).subscribe(t=>{t.valid||this.logout()})}static{this.\u0275fac=function(o){return new(o||r)(g(m))}}static{this.\u0275prov=p({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{T as a};
